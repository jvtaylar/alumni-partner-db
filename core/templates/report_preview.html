{% extends "base.html" %}

{% block title %}Report Preview - Alumni Partner Connect{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h2 class="mb-1">{{ report.title }}</h2>
            <div class="text-muted">Report Type: {{ report.get_report_type_display }} Â· Generated: {{ generated_at|date:"M d, Y H:i" }}</div>
        </div>
        <div>
            <a class="btn btn-outline-primary" href="/api/reports/{{ report.id }}/download_pdf/">
                <i class="fas fa-file-pdf"></i> Download PDF
            </a>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">Summary</h5>
            {% if report.report_type == 'alumni_summary' %}
                <ul class="list-unstyled mb-0">
                    <li><strong>Total alumni:</strong> {{ report.data.total_alumni }}</li>
                    <li><strong>Active alumni:</strong> {{ report.data.active_alumni }}</li>
                    <li><strong>Inactive alumni:</strong> {{ report.data.inactive_alumni }}</li>
                </ul>
                <hr>
                <h6>By degree</h6>
                <ul class="list-unstyled">
                    {% for deg, count in report.data.by_degree.items %}
                        <li>{{ deg }}: {{ count }}</li>
                    {% endfor %}
                </ul>
            {% elif report.report_type == 'partner_summary' %}
                <ul class="list-unstyled mb-0">
                    <li><strong>Total partners:</strong> {{ report.data.total_partners }}</li>
                </ul>
                <hr>
                <h6>By type</h6>
                <ul class="list-unstyled">
                    {% for t, count in report.data.by_type.items %}
                        <li>{{ t }}: {{ count }}</li>
                    {% endfor %}
                </ul>
                <h6 class="mt-3">By engagement level</h6>
                <ul class="list-unstyled">
                    {% for lvl, count in report.data.by_engagement_level.items %}
                        <li>{{ lvl }}: {{ count }}</li>
                    {% endfor %}
                </ul>
            {% elif report.report_type == 'engagement_analytics' %}
                <ul class="list-unstyled mb-0">
                    <li><strong>Total engagements:</strong> {{ report.data.total_engagements }}</li>
                </ul>
                <hr>
                <h6>By type</h6>
                <ul class="list-unstyled">
                    {% for t, count in report.data.by_type.items %}
                        <li>{{ t }}: {{ count }}</li>
                    {% endfor %}
                </ul>
                <h6 class="mt-3">Top partners</h6>
                <ul class="list-unstyled">
                    {% for p in report.data.top_partners %}
                        <li>{{ p.name }}: {{ p.count }}</li>
                    {% endfor %}
                </ul>
            {% elif report.report_type == 'custom_filtered' %}
                <div class="mb-3">
                    <div class="text-muted">Scope: <strong>{{ report.data.scope }}</strong></div>
                    <div class="mt-2">
                        <strong>Filters:</strong>
                        <ul class="list-unstyled mb-0">
                            {% if report.data.filters %}
                                {% for key, value in report.data.filters.items %}
                                    {% if value %}
                                        <li>{{ key|capfirst }}: {{ value }}</li>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                <li>None</li>
                            {% endif %}
                        </ul>
                    </div>
                </div>

                <div class="mb-3"><strong>Total alumni:</strong> {{ report.data.total_alumni }}</div>
                <h6>Filtered Alumni Results</h6>
                <div class="table-responsive">
                    <table class="table table-sm table-striped">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Graduation Year</th>
                                <th>Phone</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in report.data.rows %}
                                <tr>
                                    <td>{{ row.first_name }} {{ row.last_name }}</td>
                                    <td>{{ row.email }}</td>
                                    <td>{{ row.graduation_year }}</td>
                                    <td>{{ row.phone|default:"-" }}</td>
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="4" class="text-center text-muted">No results found.</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <pre class="mb-0">{{ report.data|safe }}</pre>
            {% endif %}
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Raw Data (JSON)</h5>
            <pre class="mb-0">{{ report.data|safe }}</pre>
        </div>
    </div>
</div>
{% endblock %}
